# PicoCTF 2022

```bash
Name: buffer_overflow1
Category: Binary Exploitation
Points: 100
```

## Summary

- The program `vuln.c` uses dangerous function `gets()` with a buffer size of 32.
- Overwriting the return address at `vuln()` function will help us to call the `win()` function.

## Code Snippet

```c
#define BUFSIZE 32
#define FLAGSIZE 64

void win() {
  char buf[FLAGSIZE];
  FILE *f = fopen("flag.txt","r");
  if (f == NULL) {
    printf("%s %s", "Please create 'flag.txt' in this directory with your",
                    "own debugging flag.\n");
    exit(0);
  }

  fgets(buf,FLAGSIZE,f);
  printf(buf); //prints out the flag for us.
}

void vuln(){
  char buf[BUFSIZE];
  gets(buf);

  printf("Okay, time to return... Fingers Crossed... Jumping to 0x%x\n", get_return_address());
}


```

## Solution

1. First, determine what offset which the program will crash. We can use `ragg2` to generate De Bruijn sequences and visualize what data we written on the stack.

    Syntax: `ragg2 -P 100 -r`

    Explanation: `generate a cyclic pattern of length 100 (-P) as raw bytes (-r)`.

2. Get the address of the `win()` function using a disassembler of your choice (*in this case I use radare2*).

   ![r2](https://raw.githubusercontent.com/hambyhacks/hambyhacks.github.io/main/Writeups/PicoCTF2022/Binary_Exploitation/buffer_overflow1/img/r2.png)

   ![Win func](https://raw.githubusercontent.com/hambyhacks/hambyhacks.github.io/main/Writeups/PicoCTF2022/Binary_Exploitation/buffer_overflow1/img/win.png)

3. Knowing the address of the `win()` function, we can try to overwrite the return address of `vuln()` function so that we would call `win()` function even the code does not use it.

   ![Binary run](https://raw.githubusercontent.com/hambyhacks/hambyhacks.github.io/main/Writeups/PicoCTF2022/Binary_Exploitation/buffer_overflow1/img/run_binary.png)

   ![Offset](https://raw.githubusercontent.com/hambyhacks/hambyhacks.github.io/main/Writeups/PicoCTF2022/Binary_Exploitation/buffer_overflow1/img/offset.png)

4. Now we got the offset, lets create the exploit using python `pwntools`

   ![win.py](https://raw.githubusercontent.com/hambyhacks/hambyhacks.github.io/main/Writeups/PicoCTF2022/Binary_Exploitation/buffer_overflow1/img/win_py.png)
  
   *Note: change the host and port to match your instance.*

5. Run your exploit script!

   ![flag](https://raw.githubusercontent.com/hambyhacks/hambyhacks.github.io/main/Writeups/PicoCTF2022/Binary_Exploitation/buffer_overflow1/img/flag.png)

### Flag

Flag: `picoCTF{addr3ss3s_ar3_3asy_2e53b270}`
